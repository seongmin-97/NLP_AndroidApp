# chapter 5 - 03 액티비티의 조각 프래그먼트 다루기

안드로이드의 액티비티는 화면을 표현하기 위한 기본 단위이다. 액티비티를 구성하다 보면 화면이 너무 복잡하거나 또는 코드의 양이 너무 많아졌거나 하는 이유로 화면의 부위별로 따로 동작시키고 싶을 때가 있다. 그럴 때 각각의 화면을 분할해서 독립적인 코드로 구성할 수 있게 도와주는 것이 프래그먼트(Fragment) 이다.

프래그먼트는 서로 다른 크기의 화면을 가진 기기에서 하나의 액티비티로 서로 다른 레이아웃을 구성할 수 있도록 설계되었다. 화면이 작을 때는 목록 프래그먼트만 표시한 후 목록을 클릭하면 상세 프래그컨트가 나타난다면 화면이 클 때는 둘 다 한 번에 표시하는 구조다.

이렇게 프래그먼트를 사용하면 하나의 액티비티로 조건에 따라 서로 다른 화면 구성을 만들 수 있다.

구글의 설계 의도는 앞의 구조처럼 사용하는 것이지만 실제 개발할 때는 여러 프래그먼트를 만들고 탭 매뉴나 스와이프로 화면 간 이동을 할 때 사용하거나 대형 화면을 가진 디바이스에서 메뉴와 뷰를 함께 나타내거나 여러 개의 섹션을 모듈화한 후 한 화면에 나타낼 때 사용한다.

1. 프래그먼트를 만들어 액티비티에 추가하기
    - 목록 프래그먼트 만들기

        java 디렉터리 밑에 있는 패키지명을 선택해서 프래그먼트를 생성한다. 그 후 생성된 코틀린 파일에 기본 코드가 저장되어 있다. onCreateView()는 리사이클러뷰의 onCreateViewHolder() 메서드처럼 동작하고, inflate 메서드는 리사이클러뷰에서와 동일하게 동작한다.

        프래그먼트의 xml파일에서 FrameLayout을 ConstraintLayout으로 바꾼다.

    - 액티비티에 프래그먼트 추가하기

        main액티비티의 xml파일을 열고 프래그먼트가 표시될 영역에 프레임 레이아웃을 드래그해서 가져다 놓는다.

        이제 프래그먼트를 액티비티에 삽입할 차례다. 프래그먼트를 액티비티에 삽입하는 과정은 하나의 트랜잭션응로 관리되기 때문에 트랜잭션 매니저를 통해 begin 트랜잭션, add 프래그먼트, commit 트랜잭션 순으로 처리된다.

        먼저 새로운 함수를 만든다. 내부에 상수에 ListFragment를 생성한다. 이어서 상수에 액티비티가 가지고 있는 프래그먼트 매니저를 통해서 트랜잭션을 시작하고, 시작한 트랜잭션을 저장한다.

        생성한 트랜잭션에 add()메서드로 frameLayout을 id로 가지고 있는 레이아웃에 앞에서 생성한 listFragment를 삽입한다. (R.id.frameLayout, listFragment)

        commit() 메서드로 모든 작업이 정상적으로 끝났음을 트랜잭션에 알린다.

        onCreate() 메서드 안에서 위에서 생성한 함수를 호출해서 실행한다.

    - 레이아웃에서 프래그먼트 추가하기

        fragment 컨테이너를 사용하면 소스 코드를 거치지 않고 레이아웃 파일에서도 위젯처럼 프래그먼트를 추가할 수 있다. 하나의 프래그먼트를 화면 전환 없이 사용하면 소스 코드에서 추가하는 것보다 레이아웃에서 추가하는 것이 효율적이다.

        UI에 컨테이너의 fragment를 화면에 가져다 놓는다. 앞에서 만든 ListFragment를 선택한다.

        미리보기를 하기 위해서 layout을 클릭해서 리소스 선택 창을 열어 앞에서 만든 fragment_list를 클릭한다.

2. 프래그먼트 화면 전환

    프래그먼트 간에 화면이 전환되게 해보자. 여기서는 버튼을 눌렀을 때 화면이 전환되는 것을 가정한다. 먼저 프래그먼트의 xml 파일에서 FrameLayout은 ConstraintLayout으로 변경한다.

    - 메인 액티비티에 두 프래그먼트 연결하기

        메인 액티비티에 버튼을 눌렀을 때 호출될 함수 goDetail 을 작성한다. 이 메서드가 호출 되면 DetailFragment를 생성해서 메인 액티비티의 frameLayout에 삽입한다.

        goDetail()메서드 안에 DetailFragment를 생성하고 상수에 저장한다. 또 위에서 트랜잭션을 만들고 커밋까지의 과정을 그대로 실행한다. 이때 프래그먼트는 내가 불러올 프래그먼트로 지정해야한다.

        트랜잭션의 add()와 commit() 사이에 addToBackStack()을 추가하면 스마트폰의 뒤로가기 버튼을 사용할 수 있다. 안하면 뒤로가기 누르면 액티비티가 꺼진다.

        onBackPressed()는 뒤로가기가 필요할 때 액티비티에서 사용할 수 있는 기본 메서드이다.

    - 버튼이 있는 프래그먼트의 코틀린 파일 수정

        클래스를 하나 만든 후 메인 액티비티를 담을 변수를 선언한다. onAttach(context: Context) 메서드를 상속하고 그 안에 onAttach() 메서드를 통해 넘어온 Context를 캐스팅해서 MainActivity에 담는다.

        또 onCreateView() 메서드에 있는 코드를 수정하는데 inflater로 생성한 뷰를 view 변수에 담고, view 안에 있는 버튼에 리스너를 등록한 후 리턴한다.

        배경색을 지정하지 않으면 프래그먼트들이 겹쳐보일 수 있으며 clickable 속성을 true로 바꾸어주어야 한다.

3. 프래그먼트로 값 전달하기

    크게 두 가지가 있다. 하나는 프래그먼트 생성 시에 값을 전달하는 것이고 또 하나는 이미 생성되어 있는 프래그먼트에 값을 전달하는 것이다.

    - 프래그먼트 생성 시 값 전달하기

        안드로이드에서는 프래그먼트를 생성하면서 값을 전달하는 방법으로 arguments를 제공한다. arguments는 프래그먼트의 기본 프로퍼티이기 때문에 선언 없이 사용이 가능하다.

        프래그먼트에서 전달받은 값을 꺼낼 때는 arguments에서 직접 꺼낼 수 있다.

    - 생성되어 화면에 보이는 프래그먼트에 값 전달하기

        액티비티에서 이미 생성되어 화면에 보이는 프래그먼트로 값을 전달하기 위해서는 프래그먼트에 메서드를 정의하고 직접 호출하면 된다.

    - 프래그먼트에서 프래그먼트로 값 전달하기

        프래그먼트들을 생성한 액티비티에 값을 전달할 메서드를 미리 생성해두고 사용한다. 전달해주는 쪽에서 값을 전달해주는 메서드를 호출하면 받는 쪽에서 받는 메서드를 호출한다.

        프래그먼트 - 액티비티 - 프래그먼트 의 형식으로 값이 전달된다.

4. 프래그먼트의 생명 주기 관리

    프래그먼트는 액티비티와 마찬가지로 화면에 보이는 것을 기준으로 생명 주기 메서드를 가지는데, 생성에 관한 5개와 소멸에 관한 5개를 가지고 있다.

    - 생성 주기 메서드

        생성과 관련된 5개의 생명 주기 메서드가 있지만 프래그먼트를 포함하고 있는 액티비티가 화면에 계속 나타나고 있는 상태에서는 onAttach()부터 onResume()까지의 메서드가 모두 한 번에 호출된다. 개발자는 상황에 따라 필요한 생명 주기 메서드에 넣어 사용할 수 있다.

    - 소멸 주기 메서드

        현재 프래그먼트 위로 새로운 프래그먼트가 add되거나 현재 프래그먼트를 제거하면 소멸 주기와 관련된 메서드들이 순차적으로 호출된다.